import socket                         # importa modulo socket
 
TCP_IP = '172.19.144.1'               # endereço IP do servidor 
TCP_PORTA = 10408                     # porta disponibilizada pelo servidor
TAMANHO_BUFFER = 1024                 # define do tamanho do buffer

servidor = socket.socket(socket.AF_INET, socket.SOCK_STREAM)      # cria o socket TCP

servidor.bind((TCP_IP, TCP_PORTA))    # IP e porta que o servidor aguarda conexão

servidor.listen(1)                    # define o limite de conexões

print("Servidor dispoivel na porta 5005 e escutando.....") 

isConnected = False

while True:    
    if not isConnected:             # espera uma conexão com um cliente
        conn, addr = servidor.accept()
        
        print ('Endereço conectado:', addr)
        isConnected = True
    else:
        data = conn.recv(TAMANHO_BUFFER)
        print ("Mensagem recebida: ", data)     # recebe uma mensagem do cliente
        
        if data == b"QUIT":                     # se a mensagem foi QUIT, encerra a conexão
            conn.close()
            isConnected = False
            print ('Endereço desconectado:', addr)
        else:                                   # responde a mensagem do cliente
            MENSAGEM = input("Digite sua mensagem para o cliente: ")
            conn.send(MENSAGEM.encode('UTF-8'))
            
            if MENSAGEM == "QUIT":
                conn.close()
                isConnected = False
                print ('Endereço desconectado:', addr)
