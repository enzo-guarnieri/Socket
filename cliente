import socket
import os

TCP_IP = '127.0.0.1'  # endereço IP do servidor (localhost)
TCP_PORTA = 10408     # porta disponibilizada pelo servidor
TAMANHO_BUFFER = 1024

cliente = socket.socket(socket.AF_INET, socket.SOCK_STREAM)  # cria o socket TCP para o cliente
cliente.connect((TCP_IP, TCP_PORTA))  # conecta ao servidor

def menu():
    print("Menu:")
    print("1. Enviar arquivo")
    print("2. Listar arquivos no servidor")
    print("3. Baixar arquivo do servidor")
    print("4. Deletar arquivo do servidor")
    print("5. Sair")

while True:
    menu()
    escolha = input("Escolha uma opção: ")

    if escolha == "1":
        # Enviar arquivo
        filename = input("Digite o nome do arquivo para enviar: ")
        if os.path.isfile(filename):
            cliente.send(f"SEND_FILE {filename}".encode('UTF-8'))
            with open(filename, 'rb') as f:
                print(f"Enviando arquivo: {filename}")
                while True:
                    bytes_read = f.read(TAMANHO_BUFFER)
                    if not bytes_read:
                        break
                    cliente.send(bytes_read)
            cliente.send(b"DONE")  # envia sinal de fim da transferência
            print("Arquivo enviado com sucesso.")
        else:
            print("Arquivo não encontrado.")

    elif escolha == "2":
        # Listar arquivos no servidor
        cliente.send("LIST_FILES".encode('UTF-8'))
        files = cliente.recv(TAMANHO_BUFFER).decode('UTF-8')
        print("Arquivos no servidor:\n", files)

    elif escolha == "3":
        # Baixar arquivo do servidor
        filename = input("Digite o nome do arquivo para baixar: ")
        cliente.send(f"GET_FILE {filename}".encode('UTF-8'))
        response = cliente.recv(TAMANHO_BUFFER).decode('UTF-8')
        if response.startswith("Sending"):
            with open(filename, 'wb') as f:
                print(f"Baixando arquivo: {filename}")
                while True:
                    bytes_read = cliente.recv(TAMANHO_BUFFER)
                    if bytes_read == b"DONE":  # sinal de término do envio
                        break
                    f.write(bytes_read)
            print("Arquivo baixado com sucesso.")
        else:
            print(response)

    elif escolha == "4":
        # Deletar arquivo do servidor
        filename = input("Digite o nome do arquivo para deletar: ")
        cliente.send(f"DELETE_FILE {filename}".encode('UTF-8'))
        response = cliente.recv(TAMANHO_BUFFER).decode('UTF-8')
        print(response)

    elif escolha == "5":
        # Sair
        cliente.send("QUIT".encode('UTF-8'))
        break

    else:
        print("Escolha inválida.")

cliente.close()  # fecha conexão com servidor
